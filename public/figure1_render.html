<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Figure 1: System Architecture</title>
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({ startOnLoad: true });
    </script>
    <style>
        body { font-family: sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; background: white; }
        .mermaid { transform: scale(1.5); transform-origin: center; } 
    </style>
</head>
<body>
    <div class="mermaid">
flowchart LR
    %% Define Styles
    classDef client fill:#e3f2fd,stroke:#1565c0,stroke-width:2px;
    classDef cloud fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px;
    classDef data fill:#ffffff,stroke:#333,stroke-width:1px,stroke-dasharray: 5 5;
    classDef engine fill:#bbdefb,stroke:#0d47a1,stroke-width:2px;
    classDef ai fill:#e1bee7,stroke:#4a148c,stroke-width:2px;

    %% Subgraph: Secure Local Environment
    subgraph ClientSide ["ğŸ”’ Local Client Side (Browser Sandbox)"]
        direction TB
        RawData[("ğŸ“‚ Raw Data (CSV)")]:::data
        subgraph WebEngine ["âš™ï¸ WebR Execution Engine"]
            WebR[("WebR (WASM)")]:::engine
            Packages["ğŸ“¦ R Packages<br/>(lavaan, psych)"]:::engine
        end
        RawData -->|"Read internally<br/>(No Upload)"| WebR
        WebR <--> Packages
        Results["ğŸ“„ Statistical Metadata<br/>(JSON: Loadings, p-values)"]:::data
        WebR --> Results
    end

    %% Security Barrier
    Barrier("ğŸ›¡ï¸ SECURITY BARRIER<br/>(Raw Data never crosses this line)")
    style Barrier fill:none,stroke:none,color:red

    %% Subgraph: External Cloud
    subgraph CloudSide ["â˜ï¸ External Services"]
        direction TB
        Gemini["ğŸ§  Google Gemini API<br/>(Generative AI)"]:::ai
        FinalReport["ğŸ“ Semantic Report<br/>(APA Style)"]:::data
    end

    %% Data Flow across barrier
    Results -.->|"ğŸŒ Send Anonymized Metadata Only<br/>(HTTPS / TLS 1.3)"| Gemini
    Gemini -->|"Return Interpretation"| FinalReport

    %% Layout hints
    ClientSide --- Barrier --- CloudSide
    linkStyle 3 stroke:red,stroke-width:2px,stroke-dasharray: 5 5;
    </div>
</body>
</html>
